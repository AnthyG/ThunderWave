<!DOCTYPE html>

<html>

<head>
    <title>ThunderWave</title>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <meta name="description" content="A beautiful chat for ZeroNet." />
    <meta name="keywords" content="beautiful, social, chat, thunder, wave, thunderwave" />
    <meta name="author" content="Glightstar">
    <meta name="robots" content="index, nofollow" />
    <meta name="revisit-after" content="7 days" />
    <!-- beautiful, social, chat -->

    <link rel="stylesheet" href="css/all.css" />
    <!--<link rel="stylesheet" href="css/highlight-styles/default.css" />-->
    <base href="" target="_top" id="base">
    <script>
        base.href = document.location.href.replace("/media", "").replace("index.html", "").replace(/[&?]wrapper=False/, "").replace(/[&?]wrapper_nonce=[A-Za-z0-9]+/, "")
    </script>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>

<body class="bg-gray">
    <div class="container grid-lg">
        <header class="navbar fixed shadow-drop-bottom">
            <div class="navbar container grid-lg">
                <section class="navbar-section">
                    <ul class="tab workin-tabber" tabs-target="#main-tabs" style="border-bottom-color: transparent;">
                        <li class="tab-item active">
                            <a target-tab="Lobby" href="javascript:void(0)"><i class="icon icon-people"></i></a>
                        </li>

                        <li class="tab-item hideifnotloggedin hide">
                            <a target-tab="PrivateChat" href="javascript:void(0)"><i class="icon icon-mail"></i></a>
                        </li>

                        <li class="tab-item hideifnotloggedin hide">
                            <a target-tab="GroupChat" href="javascript:void(0)"><i class="icon icon-share"></i></a>
                        </li>

                        <li class="tab-item hideifnotloggedin hide">
                            <a target-tab="LastSeen" href="javascript:void(0)"><i class="icon icon-time"></i></a>
                        </li>

                        <li class="tab-item hideifnotloggedin hide">
                            <a target-tab="Search" href="javascript:void(0)"><i class="icon icon-search"></i></a>
                        </li>
                    </ul>
                </section>
                <section class="navbar-center">
                    <a href="javascript:void(0)" class="mr-10 navbar-brand tracking-in-expand">Thunder <figure class="avatar" _data-initial="TW" style="background-color: transparent;"><img src="/1CWkZv7fQAKxTVjZVrLZ8VHcrN6YGGcdky/favicon.png"></figure> Wave</a>
                    <!--<a href="javascript:void(0)" class="mr-10 navbar-brand tracking-in-expand">ThunderWave</a>-->
                    <!--<figure class="avatar" data-initial="TW" style="background-color: #1DE9B6;"><img src="/1CWkZv7fQAKxTVjZVrLZ8VHcrN6YGGcdky/favicon.ico" /></figure>-->
                </section>
                <section class="navbar-section">
                    <div class="dropdown dropdown-right">
                        <!--<a href="#" class="btn btn-link dropdown-toggle" tabindex="0">
                            Menu <i class="icon icon-caret"></i>
                        </a>-->
                        <button class="btn btn-primary btn-action btn-lg btn-link dropdown-btn" tabindex="0">
                            <i class="icon icon-menu"></i>
                        </button>
                        <ul class="menu workin-tabber light" tabs-target="#main-tabs">
                            <li class="menu-item">
                                <div class="tile tile-centered">
                                    <div class="tile-icon" id="current_user_avatar">
                                        <figure class="avatar" data-initial="TW"></figure>
                                    </div>
                                    <div class="tile-content" id="current_user_name">
                                        Please login first
                                    </div>
                                </div>
                            </li>
                            <li class="divider hideifnotloggedin hide"></li>
                            <li class="menu-item hideifnotloggedin hide">
                                <a target-tab="Media" href="javascript:void(0)">Media</a>
                            </li>
                            <li class="menu-item hideifnotloggedin hide">
                                <a target-tab="Settings" href="javascript:void(0)">Settings</a>
                            </li>
                            <li class="divider"></li>
                            <li class="menu-item">
                                <a target-tab="About" href="javascript:void(0)">About</a>
                            </li>
                            <li class="divider"></li>
                            <li class="menu-item">
                                <a href="#Select+user" id="select_user" onclick='return page.selectUser()'>
                                    Select user
                                </a>
                            </li>
                        </ul>
                    </div>
                    <!--<a href="#Select+user" id="select_user" onclick='return page.selectUser()'>Select user</a>-->
                </section>
                <!--<section class="navbar-primary">
                    <a href="javascript:void(0)" class="navbar-brand mr-10">ThunderWave</a>
                </section>
                <section class="navbar-section">
                    <ul class="tab tab-block workin-tabber" tabs-target="#main-tabs" style="width: 100%;">
                        <li class="tab-item active">
                            <a target-tab="Lobby" href="javascript:void(0)">Lobby</a>
                        </li>
                        <li class="tab-item">
                            <a target-tab="Settings" href="javascript:void(0)">Settings</a>
                        </li>
                        <li class="tab-item">
                            <a target-tab="About" href="javascript:void(0)">About</a>
                        </li>
                    </ul>-->
                </section>
            </div>
        </header>

        <div id="main-tabs" curtab="Lobby">
            <div tab="Lobby" class="panel" onthistab="changeURL(0)">
                <div id="messagesAt" class="label fixed message-listAt"></div>

                <div class="panel-body" style="overflow-x: hidden;">
                    <button id="scrolltobottombtn" class="btn btn-action btn-lg btn-primary shadow-drop-2-bottom circle hide"><i class="icon icon-arrow-down"></i></button>

                    <ul id="messages" class="unstyled message-list"></ul>

                    <!--<div class="container grid-lg fixed" style="bottom: 0px; z-index: 998;">
                        <button id="scrolltobottombtn" class="btn btn-action btn-lg btn-primary shadow-drop-2-bottom circle hide"><i class="icon icon-arrow-down"></i></button>
                    </div>-->
                </div>

                <div id="inputsC2" class="panel-footer #fixed shadow-drop-top inputsC2">
                    <input class="hide form-input media_uploader" is-chattype="0" type="file" name="files[]" accept="image/png,image/jpg,image/jpeg,image/gif,.png,.jpg,.jpeg,.gif,audio/mp3,audio/ogg,.mp3,.ogg,video/ogg,video/mp4,mp4" />

                    <div class="hide media_previewC container grid-lg" is-chattype="0">
                        <div class="media_preview" is-chattype="0">
                            <figure class="figure">
                                <img src="" class="img-responsive img-fit-contain" alt="" />
                                <figcaption class="figure-caption text-center"></figcaption>
                            </figure>
                        </div>
                    </div>

                    <div class="container grid-lg pt-5 pb-5" style="/*background-color: #202a2f;*/">
                        <div class="input-group" style="/*padding-right: 4rem;*/">
                            <button class="btn btn-primary btn-lg btn-action input-group-btn media_selector_btn" is-chattype="0" id="media_selector_btn"><i class="icon icon-plus"></i></button>
                            <button class="btn btn-lg btn-action input-group-btn hide media_selector_cancel_btn" is-chattype="0" id="media_selector_cancel_btn"><i class="icon icon-cross"></i></button>
                            <!--<span class="input-group-addon addon-lg"><a href="#Select+user" id="select_user" onclick='return page.selectUser()'>Select user</a></span>-->
                            <!--<input type="text" class="form-input input-lg" placeholder="Message.." id="message" onkeypress="if (event.keyCode == 13) page.sendMessage()" />-->
                            <textarea class="form-input input-lg message" placeholder="Message.." id="message" is-chattype="0" onkeypress="if (event.keyCode == 13 && !event.shiftKey) { page.sendMessage(); return false; }" rows="1"></textarea>
                            <button class="btn btn-primary btn-lg btn-action input-group-btn" id="send" is-chattype="0" onclick="return page.sendMessage()"><i class="icon icon-forward"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div tab="GroupChat" class="panel" onthistab="changeURL(2)">
                <div class="panel-nav">
                    <input type="hidden" id="group_recipient" />
                    <ul class="tab" id="group_list">
                    </ul>
                </div>
                <div id="group_messagesAt" class="label fixed"></div>

                <div class="panel-body" style="overflow-x: hidden;">
                    <button id="group_scrolltobottombtn" class="btn btn-action btn-lg btn-primary shadow-drop-2-bottom circle hide"><i class="icon icon-arrow-down"></i></button>

                    <ul id="group_messages" class="unstyled message-list"></ul>
                </div>

                <div id="group_inputsC2" class="panel-footer #fixed shadow-drop-top inputsC2">
                    <input class="hide form-input media_uploader" is-chattype="2" type="file" name="files[]" accept="image/png,image/jpg,image/jpeg,image/gif,.png,.jpg,.jpeg,.gif,audio/mp3,audio/ogg,.mp3,.ogg,video/ogg,video/mp4,mp4" />

                    <div class="hide media_previewC container grid-lg" is-chattype="2">
                        <div class="media_preview" is-chattype="2">
                            <figure class="figure">
                                <img src="" class="img-responsive img-fit-contain" alt="" />
                                <figcaption class="figure-caption text-center"></figcaption>
                            </figure>
                        </div>
                    </div>

                    <div class="container grid-lg pt-5 pb-5" style="/*background-color: #202a2f;*/">
                        <div class="input-group" style="/*padding-right: 4rem;*/">
                            <button class="btn btn-primary btn-lg btn-action input-group-btn media_selector_btn" is-chattype="2" id="group_media_selector_btn"><i class="icon icon-plus"></i></button>
                            <button class="btn btn-lg btn-action input-group-btn hide media_selector_cancel_btn" is-chattype="2" id="group_media_selector_cancel_btn"><i class="icon icon-cross"></i></button>
                            <textarea class="form-input input-lg message" placeholder="Message.." id="group_message" is-chattype="2" onkeypress="if (event.keyCode == 13 && !event.shiftKey) { page.sendGroupMessage(); return false; }" rows="1"></textarea>
                            <button class="btn btn-primary btn-lg btn-action input-group-btn" id="group_send" is-chattype="2" onclick="return page.sendGroupMessage()"><i class="icon icon-forward"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div tab="PrivateChat" class="panel" onthistab="changeURL(1)">
                <div class="panel-nav">
                    <input type="hidden" id="private_recipient" />
                    <ul class="tab" id="private_contacts_list">
                    </ul>
                </div>
                <div id="private_messagesAt" class="label fixed"></div>

                <div class="panel-body" style="overflow-x: hidden;">
                    <button id="private_scrolltobottombtn" class="btn btn-action btn-lg btn-primary shadow-drop-2-bottom circle hide"><i class="icon icon-arrow-down"></i></button>

                    <ul id="private_messages" class="unstyled message-list"></ul>
                </div>

                <div id="private_inputsC2" class="panel-footer #fixed shadow-drop-top inputsC2">
                    <input class="hide form-input media_uploader" is-chattype="1" type="file" name="files[]" accept="image/png,image/jpg,image/jpeg,image/gif,.png,.jpg,.jpeg,.gif,audio/mp3,audio/ogg,.mp3,.ogg,video/ogg,video/mp4,mp4" />

                    <div class="hide media_previewC container grid-lg" is-chattype="1">
                        <div class="media_preview" is-chattype="1">
                            <figure class="figure">
                                <img src="" class="img-responsive img-fit-contain" alt="" />
                                <figcaption class="figure-caption text-center"></figcaption>
                            </figure>
                        </div>
                    </div>

                    <div class="container grid-lg pt-5 pb-5" style="/*background-color: #202a2f;*/">
                        <div class="input-group" style="/*padding-right: 4rem;*/">
                            <button class="btn btn-primary btn-lg btn-action input-group-btn media_selector_btn" is-chattype="1" id="private_media_selector_btn"><i class="icon icon-plus"></i></button>
                            <button class="btn btn-lg btn-action input-group-btn hide media_selector_cancel_btn" is-chattype="1" id="private_media_selector_cancel_btn"><i class="icon icon-cross"></i></button>
                            <textarea class="form-input input-lg message" placeholder="Message.." id="private_message" is-chattype="1" onkeypress="if (event.keyCode == 13 && !event.shiftKey) { page.sendPrivateMessage(); return false; }" rows="1"></textarea>
                            <button class="btn btn-primary btn-lg btn-action input-group-btn" id="private_send" is-chattype="1" onclick="return page.sendPrivateMessage()"><i class="icon icon-forward"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div tab="LastSeen" class="panel" onthistab="changeURL()">
                <div class="panel-body" style="overflow-x: hidden;">
                    <p>Total number of logged-in users: <b id="last_seen_list_c">0</b></p>
                    <div class="input-group">
                        <input class="form-input" placeholder="Search" type="search" id="lastseen_filterer" onkeypress="if (event.keyCode == 13 && !event.shiftKey) { page.lastSeenList(true); return false; }" />
                        <button class="btn btn-action input-group-btn" onclick="return page.lastSeenList(true);"><i class="icon icon-search"></i></button>
                    </div>
                    <dl id="last_seen_list">

                    </dl>
                </div>
            </div>

            <div tab="Search" class="panel" onthistab="changeURL()">
                <div class="panel-nav">
                    <div class="form-horizontal">
                        <div class="form-group input-group">
                            <input class="form-input" placeholder="Comma-seperated list of users" type="text" id="filrch_input_users" onkeypress="if (event.keyCode == 13 && !event.shiftKey) { page.filrchGui(); return false; }" />
                            <label class="form-switch">
                                <input id="filrch_excinc_users" type="checkbox" checked onchange="page.fu_ei = !page.fu_ei; page.filrchGui();">
                                <i class="form-icon"></i> exclude/ only
                            </label>
                        </div>
                        <div class="form-group input-group">
                            <input class="form-input" placeholder="Search" type="search" id="filrch_input_search" onkeypress="if (event.keyCode == 13 && !event.shiftKey) { page.filrchGui(); return false; }" />
                            <button class="btn btn-action input-group-btn" onclick="return page.filrchGui();"><i class="icon icon-search"></i></button>
                        </div>
                        <div class="form-group input-group">
                            <div class="input-group-addon">Only: </div>
                            <div class="form-group" id="filrch_media_filters"></div>
                        </div>
                    </div>
                </div>
                <div class="panel-body" style="overflow-x: hidden;">
                    <ul id="found_messages" class="unstyled message-list"></ul>
                </div>
            </div>

            <div tab="Media" class="panel" onthistab="changeURL()">
                <input class="form-input" type="file" id="media_uploader" name="files[]" accept="image/png,image/jpg,image/jpeg,image/gif,.png,.jpg,.jpeg,.gif,audio/mp3,audio/ogg,.mp3,.ogg,video/ogg" />
                <output id="media_list"></output>
                <button class="btn btn-primary btn-action" id="media_upload_btn"><i class="icon icon-upload"></i></button>
            </div>

            <div tab="Settings" class="panel" onthistab="changeURL()">
                <div class="panel-body" style="overflow-x: hidden;">
                    <div id="sttngs_container"></div>
                </div>
            </div>
            <div tab="About" class="panel" onthistab="changeURL()">
                <div class="panel-nav">
                    <ul class="tab workin-tabber" tabs-target="#about-tabs">
                        <li class="tab-item active">
                            <a target-tab="page-1" href="javascript:void(0)">About the Project</a>
                        </li>
                        <li class="tab-item">
                            <a target-tab="page-2" href="javascript:void(0)">Ideas/Changelog</a>
                        </li>
                        <li class="tab-item">
                            <a target-tab="page-3" href="javascript:void(0)">Site info</a>
                        </li>
                    </ul>
                </div>
                <div class="panel-body" style="overflow-x: hidden;">
                    <div id="about-tabs" curtab="page-1">
                        <div tab="page-1">
                            <img src="/1CWkZv7fQAKxTVjZVrLZ8VHcrN6YGGcdky/ThunderWave_Logo1.png" class="img-responsive" style="height: 64px;" />
                            <p><b>ThunderWave</b> is being developed with <span class="icons icons-heart active"></span> by <a href="/Me.Mkg20001.bit/?Profile/1oranGeS2xsKZ4jVsu9SVttzgkYXu4k9v/14K7EydgyeP84L1NKaAHBZTPQCev8BbqCy/glightstar@zeroid.bit">glightstar@zeroid.bit</a>                                and is based on <a href="https://decentralize.today/decentralized-p2p-chat-in-100-lines-of-code-d6e496034cd4" target="_blank">this</a> ZeroChat-Guide.<br> For style, it uses a <a href="https://github.com/AnthyG/spectre-dark"
                                    target="_blank">work-in-progress-modified fork</a> of <a href="https://picturepan2.github.io/spectre/" target="_blank">Spectre.css</a> and some icons from <a href="/Me.ZeroNetwork.bit/">ZeroMe</a>.<br><a href="https://emojione.com/"
                                    target="_blank">EmojiOne</a> is used for Emoji's and for the Autocomplete-in-Message-input,
                                <a href="https://github.com/yuku-t/jquery-textcomplete" target="_blank">jQuery-Textcomplete</a>.<br>It uses <a href="https://github.com/krasimir/gifffer" target="_blank">Gifffer</a> for the feature of toggling the animation-state
                                of Gifs.<br> Furthermore it makes use of <a href="https://github.com/chjj/marked" target="_blank">Marked</a> (with <a href="https://github.com/isagalaev/highlight.js" target="_blank">highlight.js</a> for Code-Syntax),<br>                                for the Avatars <a href="http://github.com/stewartlord/identicon.js" target="_blank">Identicon.js</a> (which requires <a href="http://www.xarg.org/download/pnglib.js">PNGLib</a>),
                                <a href="https://github.com/jonathantneal/svg4everybody" target="_blank">SVG4Everybody</a>,<br> <a href="http://momentjs.com/" target="_blank">Moment.js</a> for date_time-parsing, <a href="https://github.com/jackmoore/autosize"
                                    target="_blank">Autosize</a>, and at last, <a href="https://jquery.com/" target="_blank">jQuery</a>.</p>

                            <p><a href="/1CWkZv7fQAKxTVjZVrLZ8VHcrN6YGGcdky/favicon.ico">Favicon</a> created by <a href="/Me.Mkg20001.bit/?Profile/1oranGeS2xsKZ4jVsu9SVttzgkYXu4k9v/15XeFY67fYKCKxQPfeo246ELto2Gff1hAe/plasmmer@zeroid.bit">plasmmer@zeroid.bit</a>
                                <br><a href="/1CWkZv7fQAKxTVjZVrLZ8VHcrN6YGGcdky/ThunderWave_Logo1.png">Logo 1</a>, and <a href="/1CWkZv7fQAKxTVjZVrLZ8VHcrN6YGGcdky/ThunderWave_Logo2.png">Logo 2</a> created by <a href="/Me.Mkg20001.bit/?Profile/1RedkCkVaXuVXrqCMpoXQS29bwaqsuFdL/19sggoAZ4hcorrrfWoFWP9rwfpVsL29cnZ/sirenyc@zeroid.bit">sirenyc@zeroid.bit</a>
                                <br>Link to the <a href="https://github.com/AnthyG/ThunderWave" target="_blank">GitHub-Repository</a></p>
                        </div>
                        <div tab="page-2">
                            <p>Link to the <a href="https://github.com/AnthyG/ThunderWave" target="_blank">GitHub-Repository</a></p>
                            <p>Structure of a list-item:<br><code><i>{state}</i> Idea.. <i>(example) [requirements]</i></code></p>
                            <ul>
                                <li>{state}
                                    <ul>
                                        <li><span class="icon icon-time"></span> {Workin on it right now!}</li>
                                        <li><span class="icon icon-time"></span> {Workin on it..}</li>
                                        <li><span class="icon icon-check"></span> {"Date when finished"}</li>
                                    </ul>
                                </li>
                            </ul>
                            <hr>
                            <ul>
                                <li>Citation of messages (kinda like an answer/reply)</li>
                                <li><span class="icon icon-check"></span> {Workin on it..} Search/Filter-function in chat(s)</li>
                                <li class="divider"></li>

                                <li><span class="icon icon-check"></span> {2nd December, 2017} Media implementation (audio, video (maybe just in private chats?))</li>
                                <li class="divider"></li>

                                <li><span class="icon icon-check"></span> {8th October, 2017} Automatic Option-Updating, with 'Option'-Merging, to preserve the Users Option-States</li>
                                <li class="divider"></li>


                                <li><span class="icon icon-check"></span> {April 15th, 2017} Private messages (kinda like ZeroMail) [End2End-Encrypted, both Users have complete non-seeding encrypted Chat-history, only readable with their own private key.<br>So
                                    this will probably be <b>very</b> hard for me to create, like really! :/]</li>
                                <li><span class="icon icon-check"></span> {April 12th, 2017} Added option to delete all cached Emoji's</li>
                                <li><span class="icon icon-check"></span> {April 12th, 2017} Added option to disable Emoji's</li>
                                <li class="divider"></li>

                                <li><span class="icon icon-check"></span> {April 11th, 2017} Media implementation (just images for now), with optional downloading/ deleting!</li>
                                <li><span class="icon icon-check"></span> {April 11th, 2017} Added option to change the Message-design</li>
                                <li><span class="icon icon-check"></span> {April 11th, 2017} Added Icon</li>
                                <li class="divider"></li>

                                <li><span class="icon icon-check"></span> {April 8th, 2017} Markdown-Support [Will most certain replace the current message-input with a textarea.., YES, I will x)]</li>
                                <li><span class="icon icon-check"></span> {April 8th, 2017} Added Options-Version</li>
                                <li class="divider"></li>

                                <li><span class="icon icon-check"></span> {April 7th, 2017} Timestamp-Links (actually message-links)</li>
                                <li class="divider"></li>

                                <li><span class="icon icon-check"></span> {April 6th, 2017} Emoji's</li>
                            </ul>
                        </div>
                        <div tab="page-3">
                            <p id="out">
                                <span class="icon icons loading"></span>
                            </p>
                        </diV>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- <script src="zerocdn.min.js"></script>
    <script>
        ZeroCDN.js("jquery", "2.1.4", function() {
            console.log("jQuery loaded!");
        });
    </script> -->
    <script>
        function config$bH(goingback, is_chattype) {
            var is_chattype = is_chattype === 1 ? 'private_' : (is_chattype === 2 ? 'group_' : '')

            // console.log("configuring bodyHeight..", is_chattype)

            function configIt(alert) {
                var alert = alert || false

                // $('body').height($('body>.container')[0].scrollHeight + 28) // Disabling this, is visually preferred, but the complete thing doesn't work without it >:|
                // $('body').css('overflow-x', 'hidden')

                var $mp = $('#' + is_chattype + 'messages').parent()
                if (($('#main-tabs').attr('curtab') === "Lobby" ||
                        $('#main-tabs').attr('curtab') === "PrivateChat" ||
                        $('#main-tabs').attr('curtab') === "GroupChat") &&
                    (!goingback || $mp[0].scrollHeight - 25 <= $mp.scrollTop())) {
                    $mp.scrollTop($mp[0].scrollHeight)
                        //     $(document).scrollTop($('body>.container')[0].scrollHeight + 28)
                }
                if (goingback && page.hasOwnProperty("hadscrollheight") && page.hadscrollheight) {
                    $mp.scrollTop(($mp[0].scrollHeight - page.hadscrollheight))
                }

                if (alert)
                    console.log("bodyHeight configured!", is_chattype)
            }
            $(document).ready(function() {
                configIt(false)
                setTimeout(function() {
                    configIt(true)
                }, 1000)
            })
        }

        function changeURL(to) {
            var to_chattype = (to < 3 && to > -1) ? to : 0

            console.log("Changing URL to chattype", to)

            if (to === 1) {
                var recipient = $('#private_recipient').val()
                page.cmd("wrapperPushState", [{},
                    "ThunderWave - ZeroNet",
                    "?PC:" + recipient
                ])
            } else if (to === 2) {
                var group = $('#group_recipient').val()
                page.cmd("wrapperPushState", [{},
                    "ThunderWave - ZeroNet",
                    "?GC:" + group
                ])
            } else {
                page.cmd("wrapperPushState", [{},
                    "ThunderWave - ZeroNet",
                    "?"
                ])
            }
        }

        function answer2MSG(msgkey, is_chattype) {
            add2MSGInput('?![' + msgkey + ']', is_chattype)

            // if (typeof $('#tc_' + msgkey)[0] !== 'undefined') {
            //     var toMSG = $($('#tc_' + msgkey).children('div.card-body.text-break')[0]).text()

            //     add2MSGInput('> ' + toMSG + '\n\n')
            // }
        }

        function add2MSGInput(text, is_chattype) {
            var is_chattype = is_chattype === 1 ? 'private_' : (is_chattype === 2 ? 'group_' : '')

            $('#' + is_chattype + 'message').val($('#' + is_chattype + 'message').val() + text)
        }

        function workinTabberS(s) {
            var s = s || '.workin-tabber'
            $(s).each(function(elX, elY) {
                var $dis = $(elY)
                var mtab = $dis.attr('tabs-target')

                var $dis2 = $(mtab)

                var curtab = $dis2.attr('curtab')
                var $curtab = $dis2.find('[tab="' + curtab + '"]')

                $dis2.children().not($curtab).hide()

                // console.log($dis, $dis2, curtab, $curtab)

                var $tt = $dis.find('[target-tab]')
                $tt.off('click')
                $tt.on('click', function() {
                    changeWorkinTabber(mtab, $(this).attr("target-tab"))
                })
            })
        }

        function changeWorkinTabber(mtab, ntab) {
            var $dis = $('.workin-tabber[tabs-target="' + mtab + '"]')
            var $dis2 = $(mtab)

            var $dis3 = $dis.find('[target-tab="' + ntab + '"]')
            var curtab = $dis2.attr('curtab')
            var $curtab = $dis2.find('[tab="' + curtab + '"]')

            var ncurtab = ntab
            var $ncurtab = $dis2.find('[tab="' + ncurtab + '"]')

            $dis.find('[target-tab="' + curtab + '"]').parent().removeClass("active")
            $dis3.parent().addClass("active")

            console.log("ONTHISTAB", $ncurtab, $ncurtab.attr('onthistab'))
            eval($ncurtab.attr('onthistab'))

            $curtab.hide()
            $ncurtab.show()

            $dis2.attr('curtab', ncurtab)
            config$bH()

            // console.log(mtab, ntab, $dis, $dis2, $dis3, $curtab, $ncurtab)
        }
    </script>
    <script type="text/javascript" src="js/all.js"></script>
    <script>
        (function() {
            $("body").addClass("loaded")

            workinTabberS()

            var dropdownToggle = $(".dropdown-btn");
            dropdownToggle.on("focus", function() {
                if (!$(this).parent().hasClass('active')) {
                    $(this).parent().toggleClass('active');
                }
            });

            dropdownToggle.on("mousedown", function() {
                $(this).parent().toggleClass('active');
            });

            dropdownToggle.on("blur", function() {
                if ($(this).parent().hasClass('active')) {
                    $(this).parent().toggleClass('active');
                }
            });


            function bindEmojiCompleter(el, el2) {
                var el = el || '.message'
                var el2 = el2 || '.inputsC2'

                $(el).textcomplete([{
                    match: /\B:([\-+\w]*)$/,
                    search: function(term, callback) {
                        var results = []
                        var results2 = []
                        var results3 = []
                        $.each(emojiStrategy, function(shortname, data) {
                            if (shortname.indexOf(term) > -1) {
                                results.push(shortname)
                            } else {
                                if ((data.aliases !== null) && (data.aliases.indexOf(term) > -1)) {
                                    results2.push(shortname)
                                } else if ((data.keywords !== null) && (data.keywords.indexOf(term) > -1)) {
                                    results3.push(shortname)
                                }
                            }
                        })

                        if (term.length >= 3) {
                            results.sort(function(a, b) {
                                return (a.length > b.length)
                            })
                            results2.sort(function(a, b) {
                                return (a.length > b.length)
                            })
                            results3.sort()
                        }
                        var newResults = results.concat(results2).concat(results3)

                        callback(newResults)
                    },
                    template: function(shortname) {
                        return '<img class="emojione" src="css/png/' + emojiStrategy[shortname].unicode + '.png"> :' + shortname + ':'
                    },
                    replace: function(shortname) {
                        return ':' + shortname + ': '
                    },
                    index: 1,
                    maxCount: 5
                }], {
                    appendTo: el2,
                    dropdownClassName: 'menu dropdown-menu-messageinput light',
                    footer: '<a href="https://emoji.codes" target="_blank">Browse All<span class="arrow">Â»</span></a>',
                    maxCount: 5
                })
            }
            bindEmojiCompleter('#message', '#inputsC2')
            bindEmojiCompleter('#private_message', '#private_inputsC2')
            bindEmojiCompleter('#group_message', '#group_inputsC2')

            autosize($('.message'))
            var oldresizeH = 0
            $('.message').on('autosize:resized', function() {
                var h = $(this).parent('.inputsC2').height() - 20

                // $('#main-tabs > [tab="Lobby"]').css({
                //     "paddingBottom": h
                // })
                config$bH(true)
                if (oldresizeH > h)
                    h = -h

                // var $mp = $('#messages').parent()
                // $mp.scrollTop($mp.scrollTop() + h)

                oldresizeH = h
            })
            $('.message').on('change', function() {
                autosize.update($(this))
            })



            function readMedia(e, isp) {
                var isp = isp || '[is-chattype="0"]'

                // Check for the various File API support.
                if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
                    alert('The File APIs are not fully supported in this browser.')
                    return false
                }

                var files = e.target.files

                console.log("MUP >> 2.0 :: " + isp, files);

                $('#media_list').html("")
                var first = true
                for (var fX in files) {
                    var fY = files[fX]
                    console.log("MUP >> 2.1 :: ", fX, fY)

                    if (!fY || typeof fY !== 'object' || !fY.type.match('(image)\.(png|jpg|jpeg|gif)*|(audio)\.(mp3|ogg)*|(video)\.(ogg|mp4)*')) // !first ||      |audio|video
                        continue

                    var reader = new FileReader()
                    reader.onload = (function(f2) {
                        console.log("MUP >> 2.2.0 :: reading", f2)
                        return function(event) {
                            console.log("MUP >> 2.2.1 :: with event", event)

                            // if (!page.hasOwnProperty("MediaFiles"))
                            //     page.MediaFiles = []

                            // page.MediaFiles.push(f2)

                            // Render thumbnail
                            var media = event.target.result ?
                                (f2.type.match('image\..*') ? '<img class="img-responsive rounded {{CLASSES}}" src="' + event.target.result + '" title="' + escape(f2.name) + '" />' :
                                    (f2.type.match('audio\..*') ? '<audio controls class="{{CLASSES}}" src="' + event.target.result + '" title="' + escape(f2.name) + '"></audio>' :
                                        (f2.type.match('video\..*') ? '<video controls class="{{CLASSES}}" src="' + event.target.result + '" title="' + escape(f2.name) + '"></video>' : false))) :
                                false // (f2.type.match('audio\..*') ? '<audio controls src="' + event.target.result + '" />' : (f2.type.match('video\..*') ? '<video controls src="' + event.target.result + '" />' : false))) : 

                            if (first) {
                                first = false
                                $('.media_preview' + isp).children("figure.figure").html(media
                                    .replace(/\{\{CLASSES\}\}/gm, 'centered" alt="' + f2.name + '"') +
                                    '<figcaption class="figure-caption text-center">' + f2.name + '</figcaption>'
                                )
                                $('.media_previewC' + isp).removeClass("hide")
                                $('.media_selector_cancel_btn' + isp).removeClass('hide')
                            }

                            var el = $('<li><b>' + escape(f2.name) + '</b> (' + (f2.type || 'n/a') + ') - ' + f2.size + ' bytes, last modified: ' + (f2.lastModifiedDate ? f2.lastModifiedDate.toLocaleDateString() : 'n/a') + '<br>' + (media ? media : '<i>NO PREVIEW</i>') + '</li>')
                            el.appendTo('#media_list')
                            console.log("MUP >> 2.2.2 :: and element", el, $('#media_list')[0])
                        }
                    })(fY)
                    reader.readAsDataURL(fY)
                }
            }
            $('.media_uploader').on('change', function(e) {
                var isp = ($(this).attr("is-chattype") === "1" ? '[is-chattype="1"]' : ($(this).attr("is-chattype") === "2" ? '[is-chattype="2"]' : '[is-chattype="0"]'))
                console.log("MUP >> 1.0 :: " + isp, $('.media_uploader' + isp)[0].files)
                if ($('.media_uploader' + isp)[0].files[0]) {
                    console.log("MUP >> 1.1.0 :: ", $('.media_uploader' + isp)[0].files[0])
                    $('.media_selector_btn' + isp).html('<i class="icon icon-upload"></i>')
                    $('.media_selector_cancel_btn' + isp).removeClass('hide')
                    readMedia(e, isp)
                } else {
                    console.log("MUP >> 1.1.1 :: ", $('.media_uploader' + isp)[0].files[0])
                    $('.media_previewC' + isp).addClass("hide")
                    $('.media_selector_cancel_btn' + isp).addClass('hide')
                }
            })

            $('#media_upload_btn').on('click', function() {
                var isp = ($(this).attr("is-chattype") === "1" ? '[is-chattype="1"]' : ($(this).attr("is-chattype") === "2" ? '[is-chattype="2"]' : '[is-chattype="0"]'))
                if ($('.media_uploader' + isp)[0].files[0]) {
                    page.uploadMedia(isp, function(rtrn) {
                        if (isp === '[is-chattype="1"]')
                            add2MSGInput(rtrn, 1)
                        else if (isp === '[is-chattype="2"]')
                            add2MSGInput(rtrn, 2)
                        else
                            add2MSGInput(rtrn)
                    })
                    $('.media_previewC' + isp).addClass('hide')
                    $('.media_selector_cancel_btn' + isp).addClass('hide')
                } else {
                    $('.media_previewC' + isp).removeClass("hide")
                    $('.media_selector_cancel_btn' + isp).removeClass('hide')
                }
            })

            $('.media_selector_btn').on('click', function() {
                var isp = ($(this).attr("is-chattype") === "1" ? '[is-chattype="1"]' : ($(this).attr("is-chattype") === "2" ? '[is-chattype="2"]' : '[is-chattype="0"]'))
                console.log("MUP >> 0.0 :: " + isp)
                if ($('.media_uploader' + isp)[0].files[0]) {
                    console.log("MUP >> 0.1.0 :: ", $('.media_uploader' + isp)[0].files[0])
                    page.uploadMedia(isp, function(rtrn) {
                        if (isp === '[is-chattype="1"]')
                            add2MSGInput(rtrn, 1)
                        else if (isp === '[is-chattype="2"]')
                            add2MSGInput(rtrn, 2)
                        else
                            add2MSGInput(rtrn)
                    })
                    $('.media_previewC').addClass('hide')
                    $('.media_selector_cancel_btn' + isp).addClass('hide')
                    $('.media_selector_btn' + isp).html('<i class="icon icon-plus"></i>')
                } else {
                    console.log("MUP >> 0.1.1 :: ", $('.media_uploader' + isp)[0].files[0])
                    $('.media_uploader' + isp)[0].click();
                }
            })
            $('.media_selector_cancel_btn').on('click', function() {
                var isp = ($(this).attr("is-chattype") === "1" ? '[is-chattype="1"]' : ($(this).attr("is-chattype") === "2" ? '[is-chattype="2"]' : '[is-chattype="0"]'))
                var ctrl = $('.media_uploader' + isp)[0]
                try {
                    ctrl.value = null;
                } catch (ex) {}
                if (ctrl.value) {
                    ctrl.parentNode.replaceChild(ctrl.cloneNode(true), ctrl);
                }

                $('.media_previewC' + isp).addClass('hide')
                $('.media_selector_cancel_btn' + isp).addClass('hide')
                $('.media_selector_btn' + isp).html('<i class="icon icon-plus"></i>')
            })



            $('#scrolltobottombtn').on('click', function() {
                var $mp = $('#messages').parent()
                $mp.scrollTop($mp[0].scrollHeight)

                // var totop = $('body>.container')[0].scrollHeight + 28
                // $(document).scrollTop(totop)

                // $(document).animate({
                //     scrollTop: totop
                // }, 400, 'swing')
            })

            $(window).on('hashchange', function() {
                if (window.location.hash) {
                    var h = window.location.hash.substr(1)
                    if (h.substr(0, 3) === "tc_" || h.substr(0, 2) === "t_" || h.substr(0, 2) === "d_") {
                        var $el = $('#' + h),
                            el = $el[0]

                        // console.log("Scrollin to " + h, $(document).scrollTop(), $el.offset().top, el.scrollHeight, $el.offset().top - el.scrollHeight + 2)

                        var $mp = $('#messages').parent()
                        $mp.scrollTop($el.offset().top)

                        // $(document).scrollTop($el.offset().top - 53)
                    }
                }
            })



            page.cmd("wrapperNotification", [
                "info",
                "<b>As a warning</b>, <i>this Zite is still in Beta</i>, so to receive the<br>" +
                " newest updates you may want to <i>'Disable cache'</i><br> in your <i>'Developers console',<br>" +
                " and sometimes reset the options to default via the \"Settings\"-Tab.</i>!",
                10000
            ])



            var messagesAtTO = false
            $(window).on('resize', function() {
                config$bH(true)
            })

            setTimeout(function() {
                config$bH()
            }, 100)

            var blockscroll = false
            $('#messages').parent().on('scroll', function() {
                if (!blockscroll) {
                    blockscroll = true

                    var lowerD = 0
                    var isAt = false,
                        isAtL = ""
                    $('#messages').find('[timestamp-date]').each(function() {
                        var $dis = $(this)
                        var distance = $dis.offset().top - 53 - $(document).scrollTop()

                        var first = $(document).scrollTop() >= distance,
                            second = distance >= lowerD,
                            third = distance <= 0;
                        // console.log($dis.children('.divider.text-center').attr('data-content'), $(document).scrollTop(), distance, lowerD, first, second, third)
                        if (first && (second || lowerD === 0) && third) {
                            var $dis2 = $dis.children('.divider.text-center')
                            isAt = $dis2.attr('data-content')
                            isAtL = $dis.attr('timestamp-date')
                            lowerD = distance
                        }
                    })

                    var $mp = $('#messages').parent()
                    var bcsH = $mp[0].scrollHeight - 2000

                    // console.log($mp[0].scrollHeight, bcsH, $mp.scrollTop())

                    // var bcsH = $('body>.container')[0].scrollHeight - ($('body>.container')[0].scrollHeight / 10)
                    if ($('#main-tabs').attr("curtab") === "Lobby" && $mp.scrollTop() < bcsH) {
                        $('#scrolltobottombtn').removeClass("hide")
                    } else {
                        $('#scrolltobottombtn').addClass("hide")
                    }

                    // console.log($mp.scrollTop(), bcsH, $mp.scrollTop() < bcsH)

                    // console.log(isAt)
                    if (isAt) {
                        $('#messagesAt').html(isAt).fadeIn()
                        $('#messagesAt').attr('onclick', 'javascript:window.location.hash="#d_' + isAtL + '";')
                        clearTimeout(messagesAtTO)
                        messagesAtTO = setTimeout(function() {
                            $('#messagesAt').stop().fadeOut()
                        }, 5000)
                    } else {
                        $('#messagesAt').stop().hide()
                        clearTimeout(messagesAtTO)
                        $('#messagesAt').html("")
                            // page.loadMessages(false, false, false, false, "DESC", true)
                    }

                    if ($mp.scrollTop() - 250 <= 0) {
                        console.log("LOADING MORE")
                        page.loadMessages("load more", false)
                    }

                    setTimeout(function() {
                        blockscroll = false
                    }, 100)
                }
            })
        })()
    </script>
</body>

</html>